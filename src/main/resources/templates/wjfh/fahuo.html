<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>我要进货</title>
	<link rel="shortcut icon" href="https://gtms04.alicdn.com/tps/i4/TB1_oz6GVXXXXaFXpXXJDFnIXXX-64-64.ico" type="image/x-icon"/>
	<link rel="stylesheet" href="https://g.alicdn.com/thx/cube/1.3.2/cube.min.css">
	<link rel="stylesheet" href="/wjfh/css/iconfont.css">
	<link rel="stylesheet" type="text/css" href="/wjfh/css/common.css"/>
	<link rel="stylesheet" type="text/css" href="/wjfh/layui/css/layui.css"/>
	<link rel="stylesheet" type="text/css" href="/wjfh/css/style.css"/>
	<script src="/wjfh/js/flexible.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div class="layui-form" id="fahuo" v-cloak>
	<div class="resgcontain">
		<h1 class="site-h1">收货信息</h1>
		<div class="layui-tab layui-tab-brief">
			<div class="layui-form-item">
				<input type="radio" name="sex" value="nv" :title="receiptName" checked>
				<span class="layui-badge layui-bg-orange" style="vertical-align: sub;">联合创始人</span>
			</div>
			<div class="item">
				<input type="text" class="publicIptSty widthman"  value="收件人" placeholder=""/>
			</div>
			<div class="item">
				<input type="text" class="publicIptSty widthman"  :value="goodsdata.receiptPhone" placeholder="" />
			</div>
			<div class="item">
				<textarea placeholder="" class="publicIptSty widthman">{{goodsdata.receiptProvince}}&nbsp;{{goodsdata.receiptCity}} &nbsp;{{goodsdata.receiptDistrict}} &nbsp;{{goodsdata.receiptAddress}} </textarea>
			</div>
		</div>
	</div>
	<div class="cotpad">
		<fieldset class="layui-elem-field layui-field-title site-title">
			<legend><a name="compatibility">扫码出货</a></legend>
		</fieldset>
	</div>
	<div class="resgcontain">


		<div class="layui-tab layui-tab-brief">

			<div v-for="(goodsdatas,key) in goodsdata.data">
				<div class="item"></div>
				<div class="item">
					<div class="saomaiptbox">
						<input type="text" name="" class="layui-input layui-input-disabled" :value="goodsdatas.goodsName" autocomplete="off" placeholder="" disabled/>
						<span class="icon iconfont" style="font-size: 16px;">{{goodsdatas.goodsNum}}件</span>
					</div>
				</div>

			</div>
			<div class="item">
				<div class="saomaiptbox">
					<input type="text" class="publicIptSty widthman"  value="" placeholder="商品二维码" readonly="readonly"/>
					<span class="icon iconfont">&#xe68c;</span>
				</div>
			</div>
			<div class="item">
				<textarea class="publicIptSty widthman" placeholder="二维码" v-model="tiaoxingma"></textarea>
			</div>

			<div class="item" style="margin-bottom: 0px;">
				<input type="text" class="publicIptSty widthman" value="" placeholder="运单编号"  v-model="postCode"/>
				<img style="display: none;" id="imgUrl" src="">
			</div>


		</div>
	</div>
	<div class="shangpd">
		<button class="layui-btn layui-btn-fluid resgSubmit" @click="fahuofun();">确认出货</button>
	</div>
</div>

	<script src="/wjfh/layui/layui.js" type="text/javascript" charset="utf-8"></script>
	<script src="/wjfh/js/vue.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="/wjfh/js/axios.js" type="text/javascript" charset="utf-8"></script>
	<script src="/js/jquery.min.js?v=2.1.4" th:src="@{/js/jquery.min.js?v=2.1.4}"></script>
	<script>
        var idata = new  Vue({
            el:"#fahuo",
            data:{
                goodsdata:{},
				tiaoxingma:'',
                postCode:'',
                orderCode:'',
                receiptName:''
            },
            methods:{
                fahuofun:function () {
                    var len = 0;
                    var ddaa = idata.goodsdata.data;
					for (var idx in ddaa){
                        len += ddaa[idx].goodsNum;
					}
                    console.log(idata.tiaoxingma);
                    $.ajax({
                        cache: true,
                        type: "POST",
                        data:{
                            orderCode:idata.orderCode,
                            ids:idata.tiaoxingma,
                            postCode:idata.postCode
                        },
                        url: "/goodsManager/gmOrder/sendOrder",
                        error : function(request) {
                            layer.alert("Connection error");
                        },
                        success : function(data) {
                            if(data.code != 500){
                                layer.msg('出货成功!', {icon: 6,time: 1200},function () {
                                    parent.location.href = '/goodsManager/page/ddgl';
                                });
                            }else{
                                layer.msg(data.msg, {icon:5,time: 1200});
                            }
                            console.log(data);

                        }
                    });
                }
            },
            mounted:function () {

                layui.use(['jquery', 'form','layer'], function() {
                    $ = layui.jquery,
                        form = layui.form,
                        layer = layui.layer;
                    var local = window.location.href,goodscode='';
                    goodscode = local.split('=')[1];
                    idata.orderCode = goodscode;
                    layer.ready(function(){
                        layer.load(1);
                    });
                    $.ajax({
                        cache: true,
                        type: "POST",
						data:{goodsCode:goodscode},
                        url: "/goodsManager/gmOrder/getOrderOne",
                        error : function(request) {
                            layer.alert("Connection error");
                        },
                        success : function(data) {
                            idata.receiptName = data.receiptName;
                            idata.goodsdata = data;
                            console.log(data);
                            layer.closeAll('loading');
                            if(data.img != ''){
                                $("#imgUrl").show();
                                $("#imgUrl").attr("src",data.img);

							}
//                            layui.use('form', function() {
//                                var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
//                                form.render();
//                            });
                        }
                    });

                })
            }
        })
	</script>
</body>
</html>
